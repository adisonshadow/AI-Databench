# 字段类型配置设计文档

## 概述

本文档详细设计新建字段时，不同数据类型与其相关配置项之间的关系，确保配置的合理性和用户体验的一致性。

## 设计原则

1. **类型适配性**：不同数据类型只显示适合的配置项
2. **避免重复**：相同功能的配置项不重复出现
3. **用户友好**：提供合理的默认值和选项
4. **逻辑清晰**：配置项之间的关系明确

## 字段类型分类

### 1. TypeORM 原生类型

#### 1.1 字符串类型
- **varchar** (变长字符串)
- **char** (定长字符串)
- **text** (长文本)
- **longtext** (超长文本)

**适用配置：**
- ✅ 长度 (varchar, char)
- ✅ 可为空
- ✅ 唯一约束
- ✅ 默认值 (字符串)
- ❌ 主键 (不推荐，除非特殊需求)

#### 1.2 数字类型
- **int** (整数)
- **bigint** (长整数)
- **decimal** (精确小数)
- **float** (浮点数)
- **double** (双精度浮点数)

**适用配置：**
- ✅ 精度/小数位 (decimal, float, double)
- ✅ 可为空
- ✅ 唯一约束
- ✅ 默认值 (数字)
- ✅ 主键 (推荐用于主键)

#### 1.3 日期时间类型
- **date** (日期)
- **datetime** (日期时间)
- **timestamp** (时间戳)
- **time** (时间)

**适用配置：**
- ✅ 可为空
- ❌ 唯一约束 (通常不需要)
- ✅ 默认值 (支持当前时间选项)
- ❌ 主键 (不推荐)

#### 1.4 布尔类型
- **boolean** (布尔值)

**适用配置：**
- ✅ 可为空
- ❌ 唯一约束 (通常不需要)
- ✅ 默认值 (true/false)
- ❌ 主键 (不推荐)

#### 1.5 二进制类型
- **blob** (二进制大对象)
- **longblob** (长二进制)

**适用配置：**
- ✅ 可为空
- ❌ 唯一约束 (通常不需要)
- ❌ 默认值 (二进制类型不适合默认值)
- ❌ 主键 (不推荐)

### 2. ADB 扩展类型

#### 2.1 ADB Media (媒体文件)
- **adb-media**

**适用配置：**
- ✅ 可为空
- ❌ 唯一约束 (媒体文件通常不唯一)
- ❌ 默认值 (媒体文件不适合默认值)
- ❌ 主键 (不推荐)
- ✅ 媒体类型配置 (image/video/audio/document/file)
- ✅ 支持格式配置
- ✅ 最大大小配置
- ✅ 多文件配置
- ✅ 存储路径配置

#### 2.2 ADB Enum (枚举)
- **adb-enum**

**适用配置：**
- ✅ 可为空
- ✅ 唯一约束 (枚举值可以唯一)
- ✅ 默认值 (枚举默认值)
- ❌ 主键 (不推荐，除非特殊需求)
- ✅ 多选模式配置
- ✅ 枚举选项配置

#### 2.3 ADB Auto Increment ID (自增ID)
- **adb-auto-increment-id**

**适用配置：**
- ❌ 可为空 (自增ID不能为空)
- ❌ 唯一约束 (自增ID天然唯一)
- ❌ 默认值 (自增ID自动生成)
- ✅ 主键 (推荐用于主键)
- ✅ 起始值配置
- ✅ 增量配置
- ✅ 序列名称配置
- ✅ 是否主键配置 (内置主键功能)

#### 2.4 ADB GUID ID (全局唯一标识符)
- **adb-guid-id**

**适用配置：**
- ❌ 可为空 (GUID不能为空)
- ❌ 唯一约束 (GUID天然唯一)
- ❌ 默认值 (GUID自动生成)
- ✅ 主键 (推荐用于主键)
- ✅ GUID版本配置 (v1/v4/v5)
- ✅ 格式配置 (default/braced/binary/urn)
- ✅ 是否主键配置 (内置主键功能)
- ✅ 插入时自动生成配置

#### 2.5 ADB Snowflake ID (雪花ID)
- **adb-snowflake-id**

**适用配置：**
- ❌ 可为空 (雪花ID不能为空)
- ❌ 唯一约束 (雪花ID天然唯一)
- ❌ 默认值 (雪花ID自动生成)
- ✅ 主键 (推荐用于主键)
- ✅ 机器ID配置
- ✅ 数据中心ID配置
- ✅ 输出格式配置 (number/string)
- ✅ 是否主键配置 (内置主键功能)
- ✅ 插入时自动生成配置

## 关系配置支持

### 可用于配置关系的字段类型

在ORM设计中，某些字段类型可以用于建立实体间的关系。以下是支持关系配置的字段类型：

#### 1. 数字类型（用于外键）
- **int**：最常用的外键类型，适用于关联到其他实体的整数主键
- **bigint**：用于关联到使用bigint作为主键的实体

**关系配置特点：**
- ✅ 可用于一对一、一对多、多对一关系
- ✅ 可用于多对多关系的连接字段
- ✅ 支持级联操作配置
- ✅ 支持删除和更新策略配置

#### 2. 字符串类型（用于外键）
- **varchar**：用于关联到使用字符串作为主键的实体
- **char**：定长字符串外键（较少使用）

**关系配置特点：**
- ✅ 可用于一对一、一对多、多对一关系
- ✅ 可用于多对多关系的连接字段
- ✅ 支持级联操作配置
- ✅ 支持删除和更新策略配置

#### 3. GUID类型（用于外键）
- **adb-guid-id**：用于关联到使用GUID作为主键的实体

**关系配置特点：**
- ✅ 可用于一对一、一对多、多对一关系
- ✅ 可用于多对多关系的连接字段
- ✅ 支持级联操作配置
- ✅ 支持删除和更新策略配置

### 不支持关系配置的字段类型

以下字段类型通常不用于建立实体间的关系：

#### 1. 日期时间类型
- date, datetime, timestamp, time

#### 2. 布尔类型
- boolean

#### 3. 二进制类型
- blob, longblob

#### 4. 媒体类型
- adb-media

#### 5. 枚举类型
- adb-enum

#### 6. 自增ID类型
- adb-auto-increment-id（本身是主键生成器，不用于外键）

#### 7. 雪花ID类型
- adb-snowflake-id（本身是主键生成器，不用于外键）

## 配置项设计

### 1. 基础配置项

#### 1.1 可为空 (nullable)
- **显示条件**：所有类型都显示
- **默认值**：true (允许为空)
- **特殊处理**：ID类型强制为false

#### 1.2 唯一约束 (unique)
- **显示条件**：字符串、数字、枚举类型显示
- **默认值**：false
- **隐藏条件**：日期时间、布尔、二进制、媒体、ID类型

#### 1.3 主键 (primary)
- **显示条件**：字符串、数字类型显示
- **默认值**：false
- **隐藏条件**：日期时间、布尔、二进制、媒体、枚举类型
- **特殊处理**：ID类型有内置主键配置

#### 1.4 默认值 (default)
- **显示条件**：字符串、数字、布尔、枚举类型显示
- **默认值**：空
- **特殊处理**：
  - 日期时间类型：提供"当前时间"选项
  - ID类型：隐藏（自动生成）
  - 媒体、二进制类型：隐藏（不适合默认值）

### 2. 类型特定配置

#### 2.1 长度配置 (length)
- **适用类型**：varchar, char
- **必填**：是
- **范围**：1-65535

#### 2.2 精度配置 (precision/scale)
- **适用类型**：decimal, float, double
- **必填**：是
- **范围**：precision: 1-65, scale: 0-30

#### 2.3 日期时间默认值
- **选项**：
  - 空值
  - 当前日期 (CURRENT_DATE)
  - 当前时间 (CURRENT_TIMESTAMP)
  - 自定义值

### 3. ADB扩展类型配置

#### 3.1 媒体类型配置
- **媒体类型**：image, video, audio, document, file
- **支持格式**：根据媒体类型动态显示
- **最大大小**：MB为单位
- **多文件**：是否支持多文件上传
- **存储路径**：文件存储路径

#### 3.2 枚举配置
- **多选模式**：是否支持多选
- **枚举选项**：枚举值定义

#### 3.3 ID类型配置
- **内置主键功能**：ID类型自带主键配置，不需要额外的"主键"开关
- **自动生成**：ID类型自动生成，不需要默认值

## 实现建议

### 1. 配置项显示逻辑
```typescript
// 伪代码示例
const getFieldConfigs = (fieldType: string) => {
  const configs = {
    nullable: true, // 默认显示
    unique: false,
    primary: false,
    default: false,
    length: false,
    precision: false,
    // 关系配置支持
    relationSupport: false, // 是否支持关系配置
    // ... 其他配置
  };

  // 支持关系配置的字段类型
  const relationSupportedTypes = ['int', 'bigint', 'varchar', 'char', 'adb-guid-id'];
  
  if (relationSupportedTypes.includes(fieldType)) {
    configs.relationSupport = true;
  }

  switch (fieldType) {
    case 'varchar':
    case 'char':
      configs.length = true;
      configs.unique = true;
      configs.primary = true;
      configs.default = true;
      break;
    case 'adb-auto-increment-id':
      configs.nullable = false; // 强制不可为空
      configs.unique = false;   // 隐藏唯一约束
      configs.primary = false;  // 隐藏主键开关
      configs.default = false;  // 隐藏默认值
      break;
    // ... 其他类型
  }

  return configs;
};
```

### 2. 默认值选项
```typescript
// 日期时间类型的默认值选项
const getDefaultValueOptions = (fieldType: string) => {
  if (['date', 'datetime', 'timestamp'].includes(fieldType)) {
    return [
      { value: '', label: '空值' },
      { value: 'CURRENT_DATE', label: '当前日期' },
      { value: 'CURRENT_TIMESTAMP', label: '当前时间' },
      { value: 'custom', label: '自定义值' }
    ];
  }
  return null;
};
```

### 3. 表单验证
- ID类型：nullable, unique, default 字段隐藏且值固定
- 长度字段：varchar/char 类型必填
- 精度字段：decimal/float/double 类型必填

## 用户体验优化

### 1. 智能提示
- 选择ID类型时，提示"此类型自动设置为主键"
- 选择日期时间类型时，提示"建议使用当前时间作为默认值"
- 选择支持关系的字段类型时，提示"此字段类型可用于建立实体关系"

### 2. 配置联动
- 选择主键时，自动设置唯一约束
- 选择ID类型时，自动隐藏不适用的配置项
- 选择支持关系的字段类型时，显示关系配置选项

### 3. 默认值建议
- 根据字段类型提供合理的默认值建议
- 日期时间类型提供时间相关的默认值选项

## 总结

通过以上设计，可以确保：
1. 每个字段类型只显示适合的配置项
2. 避免重复的配置项（如ID类型的主键配置）
3. 提供合理的默认值和选项
4. 用户体验更加友好和直观
5. 明确标识哪些字段类型可以用于配置实体间的关系